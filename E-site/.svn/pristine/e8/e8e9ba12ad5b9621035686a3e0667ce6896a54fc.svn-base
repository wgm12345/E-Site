<%@ page language="java" contentType="text/html;charset=gb2312"%>
<%@ taglib prefix="c" uri="/WEB-INF/c.tld"%>
<%@ taglib prefix="fmt" uri="/WEB-INF/fmt.tld"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
		<meta http-equiv="pragma" content="no-cache" />
		<meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
		<meta http-equiv="expires" content="Wed, 26 Feb 1970 08:21:57 GMT" />
		<link href="<c:url value='/images/css/style.css' />" rel="stylesheet" type="text/css" />
		<link href="<c:url value='/css/main.css' />" rel="stylesheet" type="text/css" />
		<link href="<c:url value='/css/reset.css' />" rel="stylesheet" type="text/css" />
		
		<title>购物车</title>
		
		<style type="test/css">
		
	.onshow,.onfocus,.onerror,.oncorrect,.onload{background:url("/images/reg_bg.png") no-repeat 3000px 3000px;padding-left:30px;padding-left:30px; font-size: 12px; height:25px; width:124px; display:inline-block; line-height:25px; vertical-align:middle; overflow:hidden; margin-left:6px}
	.onshow{color:#999; padding-left:0px}
.onfocus{background-position:0px -30px; color:#333}
.onerror{background-position:0px -60px; color:#333}
.oncorrect{background-position:0px 0; text-indent:-9000px}
.onload{background-position:0px 0}
		</style>
		<script src="js/jquery/jquery-1.10.0.js" type=text/javascript></script>
<script src="js/jquery/jquery.validate-1.13.1.js" type="text/javascript" charset="UTF-8"></script>
<script src="js/jquery/formValidatorRegex.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript" src="js/jquery/jquery.flexslider.js"></script>
<script type="text/javascript" src="js/jquery/jquery.easing.js"></script>
<script type="text/javascript" src="js/jquery/jquery.jcarousel.js"></script>
<script type="text/javascript" src="js/jquery/form_elements.js"></script>

		
    <script language="javascript">
        $(document).ready(function(){
		$.formValidator.initConfig({formid:"form1",debug:false,submitonce:false,
		onerror:function(msg,obj,errorlist){
			//$.map(errorlist,function(msg1){alert(msg1)});
			alert(msg);
		}
	});

	$("#receiver").formValidator({onshow:"2-10个字符",onfocus:"2-10个字符",oncorrect:"通过"}).inputValidator({min:2,max:10,onerror:"输入有误"}).regexValidator({regexp:"^[\u4E00-\u9FFF]+$",onerror:"格式不正确"});
    $("#addr").formValidator({ onShow: "100个字符之内", onfocus: "100个字符之内", onCorrect: "谢谢你的合作，你的地址正确" }).inputValidator({max:100,onerror:"输入有误"});
	$("#rphone").formValidator({ onShow: "11位数字", onfocus: "11位数字组成的哦", onCorrect: "谢谢你的合作，你的手机正确" }).regexValidator({regexp:"^[1][3,5,8][0-9]{9}$",onerror:"格式不正确"});
	
});
function test1(obj)
{
	if(obj.value=="全角字符当做1个长度")
	{
		$.formValidator.getInitConfig("1").wideword = false;
		obj.value = "全角字符当做2个长度";
	}
	else
	{
		$.formValidator.getInitConfig("1").wideword = true;
		obj.value = "全角字符当做1个长度";
	}
	
}
        
        
        
			function updateMc(nid,count) {
				var newCountid = "newCount_" + nid.toString();
				var newCount=document.getElementById(newCountid).value;
				if(newCount != count) {
					if(newCount>0) {
						if(confirm('您确定要修改购买商品的数量吗？')) {
							location.href="<c:url value='/servlet/CartServlet?fromPage=/Cart.jsp'/>&nid=" + nid + "&newCount="+ newCount +"&act=updateFood";
						}
					} else {
						alert("商品数量不能小于1,如果不想购买请点击删除按钮 ");
						document.getElementById('mcCount').value=count;
					}
				} else {
					alert("您并没有修改商品数量！");
				}
			}
			
			function deleteMc(nid) {
				if(confirm('您确实要把该商品移出购物车吗？')) {
					location.href="<c:url value='/servlet/CartServlet?fromPage=/Cart.jsp'/>&nid=" + nid + "&act=deleteFood";
				}
			}
			
			function clearMc(nid) {
			//${param.id} el表达式
			    if(${mcCart!=null}) {
				   if(${mcCart.mcCount!=0}) {
					   if(confirm('您确定要清空购物车吗？')) {
						   location.href="<c:url value='/servlet/CartServlet?fromPage=/Cart.jsp'/>&act=clearFood";
					   }
				    } else {
					    alert("Failure!No goods.");
				    }
			    } else {
					alert("Failure!No goods.");
				}
			}
			
			function addOrder() {
			    if(${mcCart!=null}) {
				   if(${mcCart.mcCount!=0}) {
					   location.href="<c:url value='/Paymode.jsp'/>";
				   } else {
					   alert("购物车内并没有商品，不能结账");
				   }
				} else {
					alert("Failure!No goods.");
				}
			}
			
			function onKeyUpdateMc(nid,count){
				if(event.keyCode==13){
					updateMc(nid,count);
				}
			}
		</script>
	</head>
	<body>


 	<%@include file="Header.jsp" %>
			
<div>
    <div class="hr_25"></div>
  
    <form name="form1" id="form1" action="test.jsp" method="get">
    <!-- 收货地址模块 -->
   
    <div class="shoppingCart comWidth">
	<div class="shopping_item">
		<h3 class="shopping_tit">收货地址</h3>
		<div class="shopping_cont padding_shop">
			<ul class="shopping_list">
				<li><span class="shopping_list_text"><em>*</em>选择地区：</span>				
						<select name="field">
						<option value="first">福大一区</option>
						<option value="second">福大二区</option>
						<option value="third">福大三区</option>
						<option value="forth">福大四区</option>
					</select>
				</li>
				<li><span class="shopping_list_text"><em>*</em>详细地址：</span><input name="addr" id="addr" value="" class="input input_b" type="text"><span id="idname" class="onshow"></span></li>
				<li><span class="shopping_list_text"><em>*</em>收 货 人：</span><input name="receiver" id="receiver" class="input" type="text"><span id="idaddr" class="onshow"></span></li>
				<li><span class="shopping_list_text"><em>*</em>手	机：</span><input name="rphone" id="rphone" class="input" type="text"><span id="idphone" class="onshow"></span></li>
				
			</ul>
		</div>
	</div>

	<div class="hr_25"></div>
	
	<!-- 支付模块 -->
	<div class="shopping_item">
		<h3 class="shopping_tit">支付方式</h3>
		<div class="shopping_cont padding_shop">
			<ul class="shopping_list">
				<input type="radio" name="sex" value="male" /> 现金支付
				<br />
				<input type="radio" name="sex" value="female" /> 支付宝
			</ul>
		</div>
	</div>
	
	
	
	<div class="hr_25"></div>
	<!-- 购物篮模块 -->
	<div class="shopping_item">
		<h3 class="shopping_tit">送货清单<a href="#" class="backCar">返回购物车修改</a></h3>
		<div class="shopping_cont pb_10">
			<div class="cart_inner">
				<div class="cart_head clearfix">
					<div class="cart_item t_name">商品名称</div>
					<div class="cart_item t_price">单价</div>
					<!--  <div class="cart_item t_return">返现</div>-->
					<div class="cart_item t_num">数量</div>
					<div class="cart_item t_subtotal">小计</div>
					<div class="cart_item t_subtotal">操作</div>
				</div>
				<c:forEach var="mcMap" items="${mcCart.mcMap}" >
	<c:set var="mc" value="${mcMap.value}" />
				<div class="cart_cont clearfix">
					<div class="cart_item t_name">
						<div class="cart_shopInfo clearfix">
							<img src="<c:url value='${mc.mcBean.fimg}' />" alt="">
							<div class="cart_shopInfo_cont">
								<p class="cart_link"><a href="#">${mc.mcBean.fname}</a></p>
							</div>
						</div>
					</div>
					<div class="cart_item t_price">
						￥${mc.mcBean.fprice}
					</div>
					<!--  <div class="cart_item t_return">返现</div>-->
					<div class="cart_item t_num"><input type="text" value="${mc.count}" id="newCount_${mc.mcBean.fid}" class="textInput" onkeydown="onKeyUpdateMc(${mc.mcBean.fid},${mc.count});" />
                <span onclick="updateMc(${mc.mcBean.fid},${mc.count});" style="cursor:hand;">
                <img src="<c:url value='/images/icon_edit.gif' />" alt="点击修改购买商品数！" />
                </span>
                </div>
					<div class="cart_item t_subtotal">￥${mc.mcBean.fprice*mc.count}</div>
					<div class="cart_item t_subtotal"><span onclick="deleteMc(${mc.mcBean.fid});" style="cursor:hand;"><img src="<c:url value='/images/no.gif' />" alt="点击删除此商品" /></span></div>
				</div>
				</c:forEach>

			</div>
		</div>
	</div>
	<div class="hr_25"></div>
	<div class="shopping_item">
		<h3 class="shopping_tit">订单结算</h3>
		<div class="shopping_cont padding_shop clearfix">
			<div>
				<i>共有：</i><span>${mcCart.mcTypeCount}样商品</span>
			</div>
			<div>
				<i>共有：</i><span>${mcCart.mcCount}件</span>
			</div>
			<div class="cart_count fr">
				<div class="cart_rmb">
					<i>总计：</i><span>￥${mcCart.totalPrice}</span>
				</div>
				<div class="cart_btnBox">
					<input class="cart_btn" style="cursor:pointer" value="提交订单" type="submit">
				</div>
			</div>
		</div>
	 	</div>
	</div>
</form>

<div class="hr_25"></div>
</div>
  
    
 
    	<!-- 页尾 -->
	
		<%@include file="Footer.jsp" %>	
	</body>
</html>
